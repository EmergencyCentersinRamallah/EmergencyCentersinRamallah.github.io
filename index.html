<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Leaflet Search Control</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map { height: 400px; }
    </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-search/dist/leaflet-search.min.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.min.js"></script>

<script>
    var map = L.map('map').setView([31.95, 35.2], 10);

    // Example GeoJSON data for hospital, pharmacy, civil defense, and police
    var hospitalLayer = {
        "type": "FeatureCollection",
        "features": [
            { "type": "Feature", "properties": { "NAME_AR": "مستشفى أ" }, "geometry": { "type": "Point", "coordinates": [ 35.1, 31.9 ] } }
            // Add more hospital features here as needed
        ]
    };

    var pharmacyLayer = {
        "type": "FeatureCollection",
        "features": [
            { "type": "Feature", "properties": { "NAME_AR": "صيدلية أ" }, "geometry": { "type": "Point", "coordinates": [ 35.2, 31.95 ] } }
            // Add more pharmacy features here as needed
        ]
    };

    var civilLayer = {
        "type": "FeatureCollection",
        "features": [
            { "type": "Feature", "properties": { "Name_AR": "الدفاع المدني أ" }, "geometry": { "type": "Point", "coordinates": [ 35.3, 31.96 ] } }
            // Add more civil defense features here as needed
        ]
    };

    var policeLayer = {
        "type": "FeatureCollection",
        "features": [
            { "type": "Feature", "properties": { "Name_AR": "الشرطة أ" }, "geometry": { "type": "Point", "coordinates": [ 35.4, 31.97 ] } }
            // Add more police features here as needed
        ]
    };

    // Create layers from GeoJSON data
    var allLayers = L.featureGroup([
        L.geoJSON(hospitalLayer, {
            filter: function(feature, layer) {
                return feature.properties.NAME_AR !== undefined;
            }
        }),
        L.geoJSON(pharmacyLayer, {
            filter: function(feature, layer) {
                return feature.properties.NAME_AR !== undefined;
            }
        }),
        L.geoJSON(civilLayer, {
            filter: function(feature, layer) {
                return feature.properties.Name_AR !== undefined;
            }
        }),
        L.geoJSON(policeLayer, {
            filter: function(feature, layer) {
                return feature.properties.Name_AR !== undefined;
            }
        })
    ]);

    // Add layers to map
    map.addLayer(allLayers);

    // Initialize search control
    var searchControl = new L.Control.Search({
        layer: allLayers,
        propertyName: ['NAME_AR', 'Name_AR'],
        moveToLocation: function(latlng, title, map) {
            map.setView(latlng, 15);
        }
    });

    // Event listener for search:locationfound
    searchControl.on('search:locationfound', function(e) {
        e.layer.openPopup();
        if (map.routingControl) {
            map.removeControl(map.routingControl);
        }
        map.routingControl = L.Routing.control({
            waypoints: [
                L.latLng(31.95, 35.2),  // Starting point, you can customize this
                e.latlng
            ],
            routeWhileDragging: true
        }).addTo(map);
    });

    // Add search control to map
    map.addControl(searchControl);

    // Add scale control to map
    L.control.scale().addTo(map);

</script>

</body>
</html>
